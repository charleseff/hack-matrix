{
	"name": "HackMatrix Dev",
	"build": {
		"dockerfile": "Dockerfile",
		"context": ".."
	},
	"features": {
		"ghcr.io/devcontainers/features/common-utils:2": {
			"configureZshAsDefaultShell": true
		},
		"ghcr.io/devcontainers/features/github-cli:1": {},
		"ghcr.io/stu-bell/devcontainer-features/claude-code:0": {},
		"ghcr.io/devcontainers/features/git:1": {},
		"ghcr.io/devcontainers-extra/features/starship:1": {},
		"ghcr.io/devcontainers-extra/features/neovim-apt-get": {},
		"ghcr.io/dhoeric/features/google-cloud-cli:1": {},
		"ghcr.io/devcontainers/features/node:1": {}
	},
	"runArgs": [
		"--cap-add=NET_ADMIN",
		"--cap-add=NET_RAW"
	],
	"mounts": [
		// VS Code's copyGitConfig feature should copy .gitconfig automatically, but it doesn't work reliably.
		// Mount it explicitly to ensure git user.name/email are available in the container.
		"source=${localEnv:HOME}/.gitconfig,target=/home/vscode/.gitconfig,type=bind,consistency=cached",
		// Mount .netrc for wandb authentication
		"source=${localEnv:HOME}/.netrc,target=/home/vscode/.netrc,type=bind,consistency=cached",
		"source=hack-matrix-claude-config,target=/home/vscode/.claude,type=volume",
		"source=hack-matrix-zsh-history,target=/commandhistory,type=volume",
		"source=hack-matrix-gcloud-config,target=/home/vscode/.config/gcloud,type=volume"
	],
	"updateRemoteUserUID": true,
	"postCreateCommand": "sudo chown -R $(whoami) /commandhistory && (test -f python/venv-linux/bin/activate || python3 -m venv python/venv-linux) && python/venv-linux/bin/pip install -r python/requirements.txt && ./swift-build -c release && curl --proto '=https' --tlsv1.2 -LsSf https://github.com/j178/prek/releases/latest/download/prek-installer.sh | sh && prek install",
	"customizations": {
		"vscode": {
			"extensions": [
				"ms-python.python",
				"eamodio.gitlens",
				"mads-hartmann.bash-ide-vscode",
				"redhat.vscode-yaml",
				"github.copilot",
				"github.copilot-chat",
				"percygrunwald.vscode-intellij-recent-files",
				"anthropic.claude-code",
				"tripplyons.pin-active",
				"garytyler.darcula-pycharm"
			]
		}
	},
	"remoteEnv": {
		"HACKMATRIX_BINARY": "${containerWorkspaceFolder}/.build-linux/release/HackMatrix",
		"HISTFILE": "/commandhistory/.zsh_history",
		// Auto-activate venv-linux for container
		"VIRTUAL_ENV": "${containerWorkspaceFolder}/python/venv-linux",
		"PATH": "${containerWorkspaceFolder}/python/venv-linux/bin:${containerEnv:PATH}"
	}
}